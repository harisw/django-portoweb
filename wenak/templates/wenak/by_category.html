{% extends 'wenak/base.html' %}
{% load static %}
{% block content %}
<div class="container">
    <div class="d-flex flex-row mt-5 justify-content-center mb-5">
        <div class="bd-highlight w-50 text-center pt-5 border border-5" style="background-color: aliceblue;">
            <h2>{{category.name}}</h2>
            <p>{{category.description}}</p>
        </div>
        <div class="bd-highlight w-50">
            <img src="{{ category.image }}"
                    alt="{{ category.name }} image" class="rounded mx-auto" style="object-fit: cover; width: 100%; height: 100%;">
        </div>
    </div>
</div>
<div class="main-primary-color p-5">
    <h3>All {{category.name}} Recipes</h3>
    <div class="row align-items-start" id="recipeContent">
                
    </div>
</div>
{% endblock %}

{% block script%}
<script>
    var contentDiv = document.getElementById('recipeContent');
    var targetUrl = window.location.origin + "/wenak/api/recipe?tag={{category.tag}}";
    var recipeUrl = window.location.origin + "/wenak/recipe/";
    var page = 1;
    var limit = 25;

    function fetchRecipes(){
        $.ajax({
            type: "GET",
            url: `${targetUrl}&page=${page}&limit=${limit}`,
            success: (resp) => {
                var recipes = resp.data;
                console.log(recipes)
                if(recipes.length == 0){
                    Swal.fire(
                        'No result',
                        "Sorry, we can't find what you want",
                        'error'
                    )
                    return;
                }
                $(contentDiv).empty();
                for(var j=0; j<recipes.length; j++){
                    var imgSource = recipes[j].image != null ? recipes[j].image : "{%static 'img/placeholder-food.webp' %}";
                    var newHtml = `<div class="col-3 text-center">
                                    <div class="img-cover">
                                        <img src="${imgSource}"
                                        alt="Food image" class="mx-auto img-link img-poster" width="225" height="275" style="object-fit: cover;" data-url="${recipeUrl}${recipes[j].id}">
                                    </div>
                                    <div>
                                        <i class="bi bi-star-fill" style="font-size: 1.5rem; color: rgb(250, 226, 5);"></i>
                                        <i class="bi bi-star-fill" style="font-size: 1.5rem; color: rgb(250, 226, 5);"></i>
                                        <i class="bi bi-star-fill" style="font-size: 1.5rem; color: rgb(250, 226, 5);"></i>
                                        <i class="bi bi-star-fill" style="font-size: 1.5rem; color: rgb(250, 226, 5);"></i>
                                        <i class="bi bi-star-fill" style="font-size: 1.5rem; color: rgb(250, 226, 5);"></i>
                                    </div>
                                    <div class="link-wrapper">
                                        <h4 class="text-center mt-2">
                                            <a href="${recipeUrl}${recipes[j].id}" style="text-decoration: none;">${recipes[j].name}</a>
                                        </h4>
                                    </div>
                                </div>`;
                    $(contentDiv).append(newHtml);
                }
            }
        });
    }
    fetchRecipes();
    $(document).on('click', '.img-link', function() {
        window.location = $(this).data('url');
    })
</script>
{% endblock %}